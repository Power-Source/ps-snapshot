window.SS_UTILS={},window.SS_PAGES={},function(e){e(document).ready(function(){function s(){e("#wps-snapshot-key").addClass("show"),e("body").addClass("wps-popup-modal-active")}e(".wdpun-notice").detach().appendTo("section#header"),e.each(document.body.className.replace(/-/g,"_").split(/\s+/),function(e,s){"function"==typeof SS_PAGES[s]&&SS_PAGES[s]()}),e("#view-snapshot-key,#view-snapshot-key-2").on("click",function(t){t.preventDefault();var a=e(this),n=a.html(),o=(window.snapshot_messages||{}).working||n;if(a.is(".has-key"))return s();a.html(o),e.post(ajaxurl,{action:"snapshot-full_backup-exchange_key"}).done(function(e){return(e||{}).success?window.location.reload():s((e||{}).data)}).error(s).always(function(){a.html(n)})}),e(".wps-icon.i-close").on("click",function(s){e("#wps-snapshot-key").removeClass("show"),e("body").removeClass("wps-popup-modal-active")}),e(".wps-popup-close").on("click",function(s){e(this).parents(".wps-popup-modal").removeClass("show"),e("body").removeClass("wps-popup-modal-active")}),e(".wps-popup-modal").hasClass("show")?e("body").addClass("wps-popup-modal-active"):e("body").removeClass("wps-popup-modal-active"),e("select.bulk-action-selector-top").on("change",function(s){var t=e(this).val();e("select.bulk-action-selector-top").not(this).val(t).trigger("wpmu:change")});var t=e("#wps-snapshot-key");e("#wps-snapshot-key form").on("submit",function(s){s.preventDefault();var a=e(this).serializeArray();a.push({name:"action",value:"snapshot_save_key"}),a.push({name:"security",value:e(this).data("security")}),e(".wps-snapshot-popin-content",t).addClass("hidden"),e(".wps-snapshot-popin-content-step-2",t).removeClass("hidden"),e(".wps-snapshot-key.wpmud-box-gray",t).addClass("wps-processing"),jQuery.ajax({type:"POST",url:ajaxurl,data:a,dataType:"json",success:function(s){if(e(".wps-snapshot-key.wpmud-box-gray",t).removeClass("wps-processing"),e(".wps-snapshot-popin-content",t).addClass("hidden"),s.success){e(".wps-snapshot-popin-content-step-4",t).removeClass("hidden");var a=location.href;a+=-1===a.indexOf("?")?"?":"&",location.href=a+e.param({message:"success-snapshot-key"})}else e(".wps-snapshot-popin-content-step-3",t).removeClass("hidden")},error:function(){e(".wps-snapshot-key.wpmud-box-gray",t).removeClass("wps-processing"),e(".wps-snapshot-popin-content",t).addClass("hidden"),e(".wps-snapshot-popin-content-step-3",t).removeClass("hidden")}})}),e("#disable-notif").on("click",function(s){s.preventDefault();var t={security:e(this).data("security"),action:"snapshot_disable_notif_ajax"};jQuery.ajax({type:"POST",url:ajaxurl,data:t,dataType:"json",success:function(){e(".try-managed-backups-box").remove()}})}),e(".wps-message").on("click",function(s){e(this).fadeOut()}).delay(2e3).fadeOut(),e(".button-disabled").on("click",function(e){e.preventDefault()}),e(".wpmud-box-tab-title.can-toggle").on("click",function(s){s.preventDefault(),e(this).parents(".wpmud-box-tab").toggleClass("open")})})}(jQuery),function(e){window.SS_PAGES.snapshot_page_snapshot_dashboard=function(){e("#view-snapshot-key,#view-snapshot-key-2").on("click",function(){var s=e("#ss-show-apikey").html();SS_UTILS.openModal(snapshot_messages.snapshot_key,s,function(){e("#reset-api-key").on("click",function(){var s=e(this).data("url");e("<a>").attr("href",s).attr("target","_blank")[0].click()})})})}}(jQuery),function(e){window.SS_PAGES.snapshot_page_snapshot_destinations=function(){if(e("#wps-destination-delete").on("click",function(s){s.preventDefault(),e("#wps-destination-warning").addClass("show")}),e(".copy-to-clipboard").on("click",function(s){s.preventDefault();var t=e(this).data("clipboard-target"),a=e(t);a.length&&(a.select(),document.execCommand("copy"))}),e(".show-instructions").on("click",function(s){e(e(this).data("instructions")).toggle()}),"dropbox"===jQuery('[name="snapshot-destination[type]"]').val()){$form=e("#wps-destinations-wizard form"),$dropboxToken=e('[name="snapshot-destination[tokens][access][authorization_token]"]'),$submitButton=e('#wps-destinations-wizard form [type="submit"]'),$forceAuthorize=e('[name="snapshot-destination[force-authorize]"]'),$dropboxToken.on("input",function(s){e(this).val().length>0?($submitButton.val($submitButton.data("authenticate-text")),$form.attr("target",""),$forceAuthorize.val("off")):($submitButton.val($submitButton.data("get-code-text")),$form.attr("target","_blank"),$forceAuthorize.val("on"))}).trigger("input"),"on"===$forceAuthorize.val()&&$forceAuthorize.is(":checkbox")&&$forceAuthorize.is(":checked")||"on"===$forceAuthorize.val()&&$forceAuthorize.is(":hidden")?($submitButton.val($submitButton.data("get-code-text")),$form.attr("target","_blank"),$forceAuthorize.val("on")):1===$dropboxToken.length&&""!==$dropboxToken.val()?($submitButton.val($submitButton.data("authenticate-text")),$form.attr("target",""),$forceAuthorize.val("off")):($submitButton.val($submitButton.data("save-text")),$form.attr("target",""),$forceAuthorize.val("off"));var s=!1;e('[name="snapshot-destination[tokens][access][authorization_token]"]',"#wps-destination-token-checkbox").on("input",function(e){s=!0}),$forceAuthorize.filter(":checkbox").on("change",function(t){e(this).is(":checked")?($submitButton.val($submitButton.data("get-code-text")),$form.attr("target","_blank"),$forceAuthorize.val("on"),e("#wps-destination-token-checkbox").css("display","block")):(s?$submitButton.val($submitButton.data("authenticate-text")):$submitButton.val($submitButton.data("save-text")),$form.attr("target",""),$forceAuthorize.val("off"),e("#wps-destination-token-checkbox").css("display","none"))}).trigger("change")}}}(jQuery),function(e){window.SS_PAGES.snapshot_page_snapshot_managed_backups=function(){e(".wps-menu-dots").each(function(){var s=e(this),t=s.parent(".wps-menu"),a=e(".wps-menu").not(t);s.on("click",function(){a.removeClass("open"),t[t.hasClass("open")?"removeClass":"addClass"]("open")})}),e("#snapshot-edit-listing table tr").each(function(s,t){e(t).find(".msc-info").css("z-index",1e3-s)}),e('input[name="wps-managed-backups-menu"]').on("change",function(s){var t=e(this).filter(":checked").val();e('select[name="wps-managed-backups-menu-mobile"]').val(t).change(),e(".wps-managed-backups-pages > .wpmud-box").addClass("hidden").filter("."+t).removeClass("hidden")}),e('select[name="wps-managed-backups-menu-mobile"]').on("change",function(s){var t=e(this).val();e('input[name="wps-managed-backups-menu"][value="'+t+'"]').attr("checked","checked"),e(".wps-managed-backups-pages > .wpmud-box").addClass("hidden").filter("."+t).removeClass("hidden")}),e("#wps-managed-backups-configure").on("click",function(s){s.preventDefault(),e("[for='wps-managed-backups-menu-config']").click(),e("html,body").animate({scrollTop:e(".wps-managed-backups-configs").offset().top},"slow")}),e("#my-backup-all").on("change",function(){e('input[id^="my-backup"]').attr("checked",e(this).is(":checked"))}),e("#wps-managed-backups-onoff").on("change",function(s){var t=e(this).parents("form"),a=e(this).is(":checked"),n=e("#wps-managed-backups-onoff-hidden",t);a?(n.attr("name","snapshot-enable-cron"),e(".wps-managed-backups-schedule-form").removeClass("hidden")):(n.attr("name","snapshot-disable-cron"),e(".wps-managed-backups-schedule-form").addClass("hidden"));var o=t.serialize();jQuery.ajax({type:"POST",url:t.attr("src"),data:o,success:function(){}})}),window.SS_PAGES.snapshot_page_snapshot_managed_backups_create()}}(jQuery),function(e){window.SS_PAGES.snapshot_page_snapshot_managed_backups_create=function(){e(document).ready(function(){"#wps-backups-settings-schedule"===window.location.hash&&e('[for="wps-managed-backups-configs"]').click()}),e("#wps-managed-backups-configure").on("click",function(s){s.preventDefault(),e("[for='wps-managed-backups-menu-config']").click(),e("html,body").animate({scrollTop:e(".wps-managed-backups-configs").offset().top},"slow")}),jQuery("input[name='frequency']").on("change",function(){"once"===jQuery("input[name='frequency']:checked").val()?(jQuery("div#snapshot-schedule-options-container").slideUp("fast"),jQuery("#snapshot-backup-action").attr("name","snapshot-disable-cron")):(jQuery("div#snapshot-schedule-options-container").slideDown("slow"),jQuery("#snapshot-backup-action").attr("name","snapshot-schedule"))}).change(),jQuery("#wps-build-error-again").on("click",function(e){e.preventDefault(),jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").removeClass("hidden"),jQuery("form#managed-backup-update").trigger("submit")}),jQuery("#checkbox-run-backup-now").on("change",function(s){var t=e(this).is(":checked"),a=e("#managed-backup-update button[type=submit]");a.text(a.attr("data-"+(t?"run-backup":"update-settings")+"-text"))}),jQuery("form#managed-backup-update").off().on("submit",function(s){var t=e(this),a=jQuery("#frequency-once",t).is(":checked"),n=jQuery("#checkbox-run-backup-now",t).is(":checked");(a||!a&&n)&&(s.preventDefault(),jQuery("#managed-backup-update").addClass("hidden"),jQuery("#container.wps-page-builder").removeClass("hidden"),a?window.Sfb.ManualBackup.handle_start_click():jQuery.ajax({type:"POST",url:t.attr("src"),data:t.serialize(),success:function(){window.Sfb.ManualBackup.handle_start_click()}}))});var s=null;jQuery("#wps-build-progress-cancel").on("click",function(t){t.preventDefault(),null!==s&&s.abort(),e.post(ajaxurl,{action:"snapshot-full_backup-finish"},n,"json"),jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Backup aborted"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"),window.Sfb.ManualBackup.current=window.Sfb.ManualBackup.total=0,window.Sfb.ManualBackup.update_progress()}),jQuery("#wps-build-error-back").on("click",function(e){e.preventDefault(),jQuery("#container.wps-page-builder").addClass("hidden"),jQuery("#managed-backup-update").removeClass("hidden")});var t=window.Sfb||{value:function(e){return(window._snp_vars||{})[e]},l10n:function(e){return(this.value("l10n")||{})[e]||e}},a={element_selector:"",get_elements:function(){return e(this.element_selector)},initialize_listeners:function(){var s=this;return this.get_elements().each(function(){s.initialize_listener(e(this))}),!0},initialize_listener:function(e){}};t.Util={stop_prop:function(e){return e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation(),!1}},t.Notice=e.extend({},a,{element_selector:".wp-admin .notice .button.snapshot",target_selector:".backup-list td.name .location.local:first",subtarget_selector:"td",handle_target_scroll:function(s){var a=e(this).attr("data-target")||t.Notice.target_selector,n=e(this).is("[data-subtarget]")?e(this).attr("data-target"):t.Notice.subtarget_selector,o=e(a),r=0;return n&&(o=o.closest(n)),o.length&&(r=(o.offset()||{}).top-e("#wpadminbar").height())>0&&(e(window).scrollTop(r),o.fadeOut(300).fadeIn(300)),t.Util.stop_prop(s)},initialize_listener:function(e){e.off("click.snapshot").on("click.snapshot",this.handle_target_scroll)},run:function(){return this.initialize_listeners(),!0}});var n=function(){};t.ManualBackup=e.extend({},a,{element_selector:'.wp-admin .snapshot-wrap button[name="backup"]',current:0,total:0,$target:!1,skip_estimate:!1,error_handler:function(s){var a=e.trim((s||{}).responseText)||"&lt;empty response&gt;";return jQuery("#wps-build-error .wps-auth-message p").html("<p>"+a+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"),!!t.ManualBackup.initialize_listeners()},update_progress:function(){if(this.total>0&&this.current&&this.current<=this.total){var e=100*(this.current>1?this.current-1:1)/this.total;e>=100&&(e=100),jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(parseInt(e,10)+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(parseInt(e,10)+"%")}return!0},start_backup:function(){return e.post(ajaxurl,{action:"snapshot-full_backup-start"},n,"json").fail(t.ManualBackup.error_handler)},finish_backup:function(){this.update_progress();var s=e.post(ajaxurl,{action:"snapshot-full_backup-finish"},n,"json");return s.then(function(e){if(!e.status)return t.ManualBackup.finish_backup();jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"),jQuery("#wps-build-success").removeClass("hidden")}).fail(t.ManualBackup.error_handler),s},process_files:function(){this.update_progress(),e.post(ajaxurl,{action:"snapshot-full_backup-process"},n,"json").then(function(e){t.ManualBackup.current++;var s=!1;try{s=!!e.done}catch(e){return error_handler()}s?t.ManualBackup.finish_backup():t.ManualBackup.process_files()}).fail(t.ManualBackup.error_handler)},estimate_backup:function(){var s=e.post(ajaxurl,{action:"snapshot-full_backup-estimate"},n,"json");return s.then(function(e){var s=parseInt((e||{}).total||"0",10);s&&(t.ManualBackup.total=s)}).fail(t.ManualBackup.error_handler),s},handle_start_click:function(e){return jQuery("#managed-backup-update").addClass("hidden"),jQuery("#container.wps-page-builder").removeClass("hidden"),t.ManualBackup.current=1,t.ManualBackup.start_backup().then(function(e){return(e||{}).id?t.ManualBackup.skip_estimate?t.ManualBackup.process_files():t.ManualBackup.estimate_backup().then(function(){return t.ManualBackup.process_files()}):t.ManualBackup.error_handler(e)}),t.Util.stop_prop(e)},initialize_listener:function(e){return e.off("click.snapshot",this.handle_start_click).on("click.snapshot",this.handle_start_click),!0},run:function(){if(!this.get_elements().length)return!1;var s=e("#snapshot-full_backups-panel header"),t='<div id="snapshot-ajax-out"><div class="out"></div></div>';return e("#snapshot-ajax-out").remove(),s.length?s.after(t):this.get_elements().first().after(t),this.$target=e("#snapshot-ajax-out").find(".out"),this.initialize_listeners(),!0}}),t.Logs={Toggler:e.extend({},a,{element_selector:"#log-enable",handle_enable:function(){var s=t.Logs.Toggler.get_elements(),a=s.is(":checked"),n=s.attr("data-default");a?e(".snapshot-settings.log-levels").show():e(".snapshot-settings.log-levels").hide().find('input[type="radio"]').attr("checked",!1).end().find('input[type="radio"][value="'+n+'"]').attr("checked",!0)},initialize_listener:function(e){e.off("click.snapshot").on("click.snapshot",this.handle_enable)},run:function(){return this.initialize_listeners(),this.handle_enable(),!0}}),Viewer:e.extend({},a,{element_selector:'a[href="#view-log-file"]',ttl:12e4,handle_view:function(a){ttl=t.Logs.Viewer.ttl?parseInt(t.Logs.Viewer.ttl,10):0,e("#wps-snapshot-log div.wps-log-box").replaceWith(e('<pre class="wps-log-box">')),e("#wps-snapshot-log .wps-log-box").html("Loading...<br />"),e("#wps-snapshot-log").addClass("show");var n=ajaxurl+"?action=snapshot-full_backup-get_log",o=setInterval(void(e("#wps-snapshot-log").length&&e("#wps-snapshot-log").is(".show")?s=jQuery.ajax({type:"POST",url:n,cache:!1,dataType:"html",error:function(e,s,t){clearInterval(o)},success:function(s){e(s).length>0?(e("#wps-snapshot-log .wps-log-box").html(e(s).text()),e("#wps-snapshot-log .wps-log-box").scrollTop(e("#wps-snapshot-log .wps-log-box")[0].scrollHeight)):e("#wps-snapshot-log .wps-log-box").html(s)}}):clearInterval(o)),ttl);return t.Util.stop_prop(a)},initialize_listener:function(e){e.off("click.snapshot").on("click.snapshot",this.handle_view)},run:function(){return this.initialize_listeners(),!0}}),run:function(){return t.Logs.Toggler.run(),t.Logs.Viewer.run(),!0}},window.Sfb=t,e(function(){t.Notice.run(),t.Logs.run(),t.ManualBackup.run()})}}(jQuery),function(e){window.SS_PAGES.snapshot_page_snapshot_managed_backups_restore=function(){function s(s){"error"===s?(e("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Restoration failed"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden")):"done"===s?(e("#wps-build-progress .wps-total-status .wps-loading-number").html("100%"),e("#wps-build-progress .wps-total-status .wps-loading-bar span").width("100%"),e("#wps-build-error").addClass("hidden"),e("#wps-build-progress").addClass("hidden"),e("#wps-build-success").removeClass("hidden")):"fetch"===s?(e("#wps-build-progress .wps-total-status .wps-loading-number").html("40%"),e("#wps-build-progress .wps-total-status .wps-loading-bar span").width("40%")):"process"===s&&(e("#wps-build-progress .wps-total-status .wps-loading-number").html("80%"),e("#wps-build-progress .wps-total-status .wps-loading-bar span").width("80%"))}e("#wps-show-full-log").on("click",function(s){s.preventDefault();var t=e(this);e("#wps-log").is(".hidden")?(t.text(t.attr("data-wps-hide-title")),e("#wps-log").removeClass("hidden")):(t.text(t.attr("data-wps-show-title")),e("#wps-log").addClass("hidden"))}),e("#wps-build-error-again").on("click",function(s){s.preventDefault(),e("#wps-build-error").addClass("hidden"),e("#wps-build-progress").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").addClass("hidden"),e(".wpmud-box-title .wps-title-progress").removeClass("hidden"),e("form#managed-backup-restore").submit()}),e("#wps-build-error-back").on("click",function(s){s.preventDefault(),e("#wps-build-error").addClass("hidden"),e("#wps-build-progress").removeClass("hidden"),e("#managed-backup-restore").removeClass("hidden"),e("#container.wps-page-builder").addClass("hidden"),e(".wpmud-box-title .wps-title-result").addClass("hidden"),e(".wpmud-box-title .wps-title-progress").removeClass("hidden")}),e("#wps-cancel").off().on("click",function(s){s.preventDefault(),e("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(snapshot_messages.restore_aborted),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden")}),e("form#managed-backup-restore").off().on("submit",function(t){t.preventDefault(),e("#managed-backup-restore").addClass("hidden"),e("#snapshot-ajax-warning").html(""),e("#snapshot-ajax-warning").hide(),e("#container.wps-page-builder").removeClass("hidden");var a=new e.Deferred,n=e("form#managed-backup-restore :hidden.archive"),o=e("form#managed-backup-restore :text.location"),r=e("form#managed-backup-restore .request-filesystem-credentials-form input"),i={},p=function(t){t.action="snapshot-full_backup-restore",e.post(ajaxurl,t,function(){},"json").then(function(n){if(!n||(n||{}).error)return e("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Error restoring backup"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden"),a.resolve(),!1;"clearing"!==n.task?(s("fetching"===n.task?"fetch":"process"),p(t)):(s(n.status?"done":"error"),a.resolve())}).fail(function(){return a.resolve(),e("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("Restoration failed"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden"),!1})};return i={idx:undefined,archive:n.val(),restore:o.val(),credentials:{}},r.each(function(){var s=e(this);s.is(":radio")||s.is(":checkbox")?s.is(":checked")&&(i.credentials[s.attr("name")]=s.val()):(s.is(":text")||s.is(":password")||s.is(":hidden"))&&(i.credentials[s.attr("name")]=s.val())}),s("fetch"),e(window).on("beforeunload.snapshot-restore",function(e){var s="You still have a restore active, navigating off this page will stop it mid-process";return e.returnValue=s,s}),p(i),a.promise().always(function(){e(window).off("beforeunload.snapshot-restore")})})}}(jQuery),function(e){window.SS_PAGES.snapshot_page_snapshot_settings=function(){e('[name="files"]').on("change",function(){e('[name="files"]:checked').is("#common_files")?e("#wps-settings-localdir .wpmud-box-gray").removeClass("hidden"):e("#wps-settings-localdir .wpmud-box-gray").addClass("hidden")}).change(),e("#wps-settings--error .wps-input--parent > .wps-input--checkbox > input").each(function(){e(this).on("change",function(){var s=e(this),t=s.parents(".wps-input--parent").next(".wpmud-box-gray");s.is(":checked")?t.removeClass("hidden"):t.addClass("hidden")}).change()})}}(jQuery),function(e){window.SS_PAGES.snapshot_page_snapshot_snapshot_create=function(){jQuery("input[name='frequency']").on("change",function(){"once"===jQuery("input[name='frequency']:checked").val()?(jQuery("#snapshot-immediate").attr("disabled",!1).attr("checked",!0),jQuery("#snapshot-interval").attr("disabled",!0),jQuery("div#snapshot-schedule-options-container").slideUp("fast"),jQuery("#snapshot-add-update-submit").text(jQuery("#snapshot-add-update-submit").data("title-save-and-run"))):(jQuery("#snapshot-immediate").attr("disabled",!0).attr("checked",!1),jQuery("#snapshot-interval").attr("disabled",!1),jQuery("div#snapshot-schedule-options-container").slideDown("slow"),jQuery("#checkbox-run-backup-now").is(":checked")||jQuery("#snapshot-add-update-submit").text(jQuery("#snapshot-add-update-submit").data("title-save-only")))}).change(),jQuery("#checkbox-run-backup-now").on("change",function(){e(this).is(":checked")&&"once"!==jQuery("input[name='frequency']:checked").val()?jQuery("#snapshot-add-update-submit").text(jQuery("#snapshot-add-update-submit").data("title-save-and-run")):"once"!==jQuery("input[name='frequency']:checked").val()&&jQuery("#snapshot-add-update-submit").text(jQuery("#snapshot-add-update-submit").data("title-save-only"))}).change(),jQuery("[name=snapshot-destination]").on("change",function(){"dropbox"==jQuery("[name=snapshot-destination]:checked").attr("data-destination-type")?jQuery("input#snapshot-destination-sync-mirror").attr("disabled",!1):(jQuery("input#snapshot-destination-sync-mirror").attr("disabled","disabled"),jQuery("input#snapshot-destination-sync-archive").attr("checked","checked"))}).change();var s=null,t=!1;function a(){return null!==s&&s.abort(),t=!0,jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(snapshot_messages.snapshot_aborted),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"),!1}jQuery("#wps-show-full-log").on("click",function(e){e.preventDefault();var s=jQuery(this),t=jQuery("#wps-log");t.is(".hidden")?(s.text(s.attr("data-wps-hide-title")),t.removeClass("hidden")):(s.text(s.attr("data-wps-show-title")),t.addClass("hidden"))}),jQuery("#wps-build-error-again").on("click",function(e){e.preventDefault(),jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").addClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").removeClass("hidden"),jQuery("form#snapshot-add-update").submit()}),jQuery("#wps-build-error-back").on("click",function(e){e.preventDefault(),jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").removeClass("hidden"),jQuery("#snapshot-add-update").removeClass("hidden"),jQuery("#container.wps-page-builder").addClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").addClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").removeClass("hidden")}),jQuery("#wps-cancel").off().on("click",function(s){s.preventDefault(),a(),e("html,body").animate({scrollTop:e("#container.wps-page-builder").offset().top},"slow")}),e("#container.wps-page-builder").off("click.abort").on("click.abort","a.snapshot-button-abort",function(s){s.preventDefault(),a(),e("html,body").animate({scrollTop:e("#container.wps-page-builder").offset().top},"slow")}),jQuery(".snapshot-tables-option, .snapshot-files-option").on("change",function(){1===jQuery("#snapshot-tables-option-none:checked").length&&1===jQuery("#snapshot-files-option-none:checked").length?(jQuery("#snapshot-ajax-error").html("<p>"+snapshot_messages.no_files_tables+"</p>").show(),jQuery("#snapshot-add-update-submit").addClass("button-disabled")):(jQuery("#snapshot-ajax-error").html("").hide(),jQuery("#snapshot-add-update-submit").removeClass("button-disabled"))}),jQuery("form#snapshot-add-update").off().on("submit",function(a){t=!1,jQuery('[id^="snapshot-item-table-"]').remove(),jQuery("#snapshot-item-file").remove();var n=[],o=jQuery("input.snapshot-files-option:checked").val(),r="archive",i="";if("none"!==o){if("all"===o);else if("selected"===o&&(jQuery("input.snapshot-backup-sub-options:checked",this).each(function(){n[n.length]=jQuery(this).attr("value")}),0===n.length))return jQuery("#snapshot-ajax-warning").html("<p>"+snapshot_messages.no_files_selected+"</p>").show(),!1;i=jQuery("textarea#snapshot-files-ignore").val(),r=jQuery("input.snapshot-destination-sync:checked").val()}var p,d=[],l=jQuery("input.snapshot-tables-option:checked").val();if("selected"===l){if(jQuery("input.snapshot-table-item:checked",this).each(function(){var e=jQuery(this).attr("value");d[d.length]=e}),0===d.length)return jQuery("#snapshot-ajax-warning").html("<p>"+snapshot_messages.no_tables_selected+"</p>").show(),!1}else"all"===l&&jQuery("input.snapshot-table-item",this).each(function(){d[d.length]=jQuery(this).attr("value")});if("none"===o&&"none"===l)return jQuery("#snapshot-ajax-error").html("<p>"+snapshot_messages.no_files_tables+"</p>").show(),!1;var u=jQuery("input#snapshot-action",this).val();"add"!==u&&"update"!==u||(p=jQuery("input#snapshot-item",this).val());var h=jQuery("input#snapshot-data-item",this).val();if(""===p)return jQuery("#snapshot-ajax-warning").html("<p>"+snapshot_messages.missing_timekey+"</p>").show(),!1;var c="once"!==jQuery("input[name=frequency]:checked",this).val()?jQuery("select#snapshot-interval",this).val():"immediate";if(!jQuery("#checkbox-run-backup-now",this).is(":checked")&&"immediate"!==c)return!0;a.preventDefault();var w=jQuery("input#snapshot-archive-count",this).val(),m=jQuery("[name=snapshot-destination]:checked",this).val(),b=jQuery("select#snapshot-destination-local",this).val(),g=jQuery("input#snapshot-destination-directory",this).val(),f=0;f=jQuery("select#snapshot-blog-id",this).length>0?jQuery("select#snapshot-blog-id",this).val():jQuery("input#snapshot-blog-id",this).val();var y,v=jQuery("input#snapshot-name",this).val(),j=jQuery("textarea#snapshot-notes",this).val();for(var _ in o=jQuery("input:radio[name=snapshot-files-option]:checked",this).val(),jQuery("#snapshot-ajax-warning").html("").hide(),jQuery("#snapshot-add-update").addClass("hidden"),d)if(d.hasOwnProperty(_)){var C=d[_];y=e('<tr id="snapshot-item-table-'+C+'"></tr>').append(e("#wps-log-process-template").html()).find(".wps-log-process.name").html(C).end(),jQuery("tr#wps-log-process-finish").before(y)}"all"!==o&&"selected"!==o||(y=e('<tr id="snapshot-item-file"></tr>').append(e("#wps-log-process-template").html()).find(".wps-log-process.name").html('Files: <span class="snapshot-filename" style="font-style: italic;"></span>').end(),jQuery("tr#wps-log-process-finish").before(y)),jQuery("#container.wps-page-builder").removeClass("hidden");var Q=d.length+2,x=0,k=[],S=[];return function a(y,_){var C,M;if("init"===y)C=y,M={action:"snapshot_backup_ajax","snapshot-proc-action":y,"snapshot-action":u,"snapshot-item":p,"snapshot-data-item":h,"snapshot-blog-id":f,"snapshot-name":v,"snapshot-notes":j,"snapshot-files-option":o,"snapshot-files-sections":n,"snapshot-files-ignore":i,"snapshot-tables-option":l,"snapshot-tables-array":d,"snapshot-interval":c,"snapshot-archive-count":w,"snapshot-destination":m,"snapshot-store-local":b,"snapshot-destination-directory":g,"snapshot-destination-sync":r},jQuery("[id^=snapshot-interval-offset]").each(function(){M[this.name]=this.value}),s=jQuery.ajax({type:"POST",url:ajaxurl,data:M,dataType:"json",error:function(e,s,t){!1!==e.responseText&&""!==e.responseText?(jQuery("#wps-build-error .wps-auth-message p").html(e.responseText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error .wps-auth-message p").html("<p>AAA "+snapshot_messages.snapshot_failed+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))},success:function(s){if(void 0===s||void 0===s.errorStatus)jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>BBB "+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden");else if(!1!==s.errorStatus)void 0===s.errorText?(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>CCC "+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#snapshot-ajax-error").append(s.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else if(!1===s.errorStatus||!1===t){var n=y;jQuery("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-bar span").width("100%"),jQuery("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-number").html("100%"),jQuery("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),jQuery("#container.wps-page-builder #wps-log-process-init .wps-loading-status").removeClass("wps-spinner"),jQuery("#container.wps-page-builder #wps-log-process-init .snapshot-button-abort").addClass("hidden"),x++;var o=Math.min(100,Math.round(100*x/Q));if(jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(o+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(o+"%"),!1===t){if(void 0!==s.files_data&&(S=s.files_data,Q+=S.length),void 0!==s.table_data){k=s.table_data;var r=JSON.stringify(s.table_data);if(r)for(var i in d)if(d.hasOwnProperty(i)){n=d[i];-1===r.indexOf(n)&&e("#snapshot-item-table-"+n).remove()}a("table",0)}void 0!==s.MEMORY&&(void 0!==s.MEMORY.memory_limit&&jQuery("#snapshot-memory-info").find(".log-memory.number").html(s.MEMORY.memory_limit),void 0!==s.MEMORY.memory_usage_current&&jQuery("#snapshot-memory-info .log-usage.number").html(s.MEMORY.memory_usage_current),void 0!==s.MEMORY.memory_usage_peak&&jQuery("#snapshot-memory-info .log-peak.number").html(s.MEMORY.memory_usage_peak))}}}});else if("table"===y){var T=parseInt(_),E=T+1;if(E>k.length)return void(S.length>0?a("file",0):a("finish",0));var A=k[T];C=A.table_name,jQuery("#container.wps-page-builder #snapshot-item-table-"+C+" a.snapshot-button-abort").removeClass("hidden"),jQuery("#container.wps-page-builder #snapshot-item-table-"+C+" .wps-spinner").removeClass("hidden"),M={action:"snapshot_backup_ajax","snapshot-proc-action":y,"snapshot-action":u,"snapshot-item":p,"snapshot-data-item":h,"snapshot-blog-id":f,"snapshot-table-data-idx":T},s=jQuery.ajax({type:"POST",url:ajaxurl,data:M,dataType:"json",error:function(e,s,t){!1!==e.responseText&&""!==e.responseText?(jQuery("#wps-build-error .wps-auth-message p").html(e.responseText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))},success:function(e){if(void 0===e||void 0===e.errorStatus)jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden");else if(!1!==e.errorStatus)void 0===e.errorText?(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#snapshot-ajax-error").append(e.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else if(!1===e.errorStatus||!1===t){if(void 0===e.table_data)void 0!==e.errorText?(jQuery("#snapshot-ajax-error").append(e.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else{var s;A=e.table_data;var n=parseInt(A.rows_start)+parseInt(A.rows_end);if(n>0?(s=Math.ceil(n/A.rows_total*100),jQuery("#container.wps-page-builder #snapshot-item-table-"+A.table_name+" .wps-loading-status .wps-loading-bar span").width(s+"%"),jQuery("#container.wps-page-builder #snapshot-item-table-"+A.table_name+" .wps-loading-status .wps-loading-number").html(s+"%")):(s=100,jQuery("#container.wps-page-builder #snapshot-item-table-"+A.table_name+" .wps-loading-status .wps-loading-bar span").width(s+"%"),jQuery("#container.wps-page-builder #snapshot-item-table-"+A.table_name+" .wps-loading-status .wps-loading-number").html(s+"%")),100===s){jQuery("#container.wps-page-builder #snapshot-item-table-"+A.table_name+" .snapshot-button-abort").hide(),jQuery("#container.wps-page-builder #snapshot-item-table-"+A.table_name+" .wps-spinner").hide(),jQuery("#container.wps-page-builder #snapshot-item-table-"+A.table_name+" .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),x++;var o=Math.min(100,Math.ceil(100*x/Q));jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(o+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(o+"%")}void 0!==e.MEMORY&&(void 0!==e.MEMORY.memory_limit&&jQuery("#snapshot-memory-info span.memory-limit").html(e.MEMORY.memory_limit),void 0!==e.MEMORY.memory_usage_current&&jQuery("#snapshot-memory-info span.memory-usage").html(e.MEMORY.memory_usage_current),void 0!==e.MEMORY.memory_usage_peak&&jQuery("#snapshot-memory-info span.memory-peak").html(e.MEMORY.memory_usage_peak))}a("table",E)}}})}else if("file"===y){var O=parseInt(_),B=O+1;if(C=y,B>S.length)return a("finish",0),!1;var $=S[O];jQuery("#snapshot-item-"+C+" .snapshot-filename").html(": "+$),jQuery("#container.wps-page-builder #snapshot-item-"+C+" a.snapshot-button-abort").removeClass("hidden"),jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-spinner").removeClass("hidden"),M={action:"snapshot_backup_ajax","snapshot-proc-action":y,"snapshot-action":u,"snapshot-item":p,"snapshot-data-item":h,"snapshot-blog-id":f,"snapshot-file-data-key":$},s=jQuery.ajax({type:"POST",url:ajaxurl,data:M,dataType:"json",error:function(e,s,t){!1!==e.responseText&&""!==e.responseText?(jQuery("#wps-build-error .wps-auth-message p").html(e.responseText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))},success:function(e){if(void 0===e||void 0===e.errorStatus)jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden");else if(!1!==e.errorStatus)void 0===e.errorText?(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#snapshot-ajax-error").append(e.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else if(!1===e.errorStatus||!1===t){var s;if(B<S.length)s=Math.ceil(B/S.length*100),jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-loading-status .wps-loading-bar span").width(s+"%"),jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-loading-status .wps-loading-number").html(s+"%");else{x++;var n=Math.min(100,Math.ceil(100*x/Q));jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(n+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(n+"%"),s=100,jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-loading-status .wps-loading-bar span").width(s+"%"),jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-loading-status .wps-loading-number").html(s+"%"),jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-loading-status .wps-loading-bar .wps-loader").addClass("done")}100==s&&(jQuery("#container.wps-page-builder #snapshot-item-"+C+" .snapshot-button-abort").hide(),jQuery("#container.wps-page-builder #snapshot-item-"+C+" .wps-spinner").hide(),jQuery("#snapshot-item-"+C+" .snapshot-filename").html("")),void 0!==e.MEMORY&&(void 0!==e.MEMORY.memory_limit&&jQuery("#snapshot-memory-info span.memory-limit").html(e.MEMORY.memory_limit),void 0!==e.MEMORY.memory_usage_current&&jQuery("#snapshot-memory-info span.memory-usage").html(e.MEMORY.memory_usage_current),void 0!==e.MEMORY.memory_usage_peak&&jQuery("#snapshot-memory-info span.memory-peak").html(e.MEMORY.memory_usage_peak)),a("file",B)}}})}else if("finish"==y){C=y,jQuery("#container.wps-page-builder #snapshot-item-table-"+C+" .wps-loading-status .wps-loading-bar span").width("0%"),jQuery("#container.wps-page-builder #snapshot-item-table-"+C+" .wps-loading-status .wps-loading-number").html("0%");var D=jQuery("#container.wps-page-builder #snapshot-item-table-"+C+" .snapshot-text").html();jQuery("#container.wps-page-builder #snapshot-item-table-"+C+" .snapshot-text").html(D+" (creating zip archive of tables)"),M={action:"snapshot_backup_ajax","snapshot-proc-action":y,"snapshot-action":u,"snapshot-item":p,"snapshot-data-item":h,"snapshot-blog-id":f},s=jQuery.ajax({type:"POST",url:ajaxurl,data:M,dataType:"json",error:function(e,s,t){!1!==e.responseText&&""!==e.responseText?(jQuery("#wps-build-error .wps-auth-message p").html(e.responseText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))},success:function(e){if(void 0===e||void 0===e.errorStatus)jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden");else if(!1!==e.errorStatus)void 0===e.errorText?(jQuery("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden")):(jQuery("#snapshot-ajax-error").append(e.errorText),jQuery("#wps-build-error").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-result").removeClass("hidden"),jQuery(".wpmud-box-title .wps-title-progress").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"));else if(!1===e.errorStatus||!1===t){x++;var s=Math.min(100,Math.ceil(100*x/Q));jQuery("#wps-build-progress .wps-total-status .wps-loading-number").html(s+"%"),jQuery("#wps-build-progress .wps-total-status .wps-loading-bar span").width(s+"%");jQuery("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-bar span").width("100%"),jQuery("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-number").html("100%"),jQuery("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),jQuery("#container.wps-page-builder #wps-log-process-finish .wps-loading-status").removeClass("wps-spinner"),void 0!==e.MEMORY&&(void 0!==e.MEMORY.memory_limit&&jQuery("#snapshot-memory-info span.memory-limit").html(e.MEMORY.memory_limit),void 0!==e.MEMORY.memory_usage_current&&jQuery("#snapshot-memory-info span.memory-usage").html(e.MEMORY.memory_usage_current),void 0!==e.MEMORY.memory_usage_peak&&jQuery("#snapshot-memory-info span.memory-peak").html(e.MEMORY.memory_usage_peak)),void 0!==e.responseText&&(jQuery("#wps-build-success").removeClass("hidden").find(".wps-auth-message.success").html("<p>"+e.responseText+"</p>"),jQuery("#wps-build-success-view").attr("href",jQuery("#wps-build-success .wps-auth-message.success").find("a").attr("href")),jQuery("#wps-build-error").addClass("hidden"),jQuery("#wps-build-progress").addClass("hidden"))}}})}}("init",0),!0})}}(jQuery),function(e){window.SS_PAGES.snapshot_page_snapshot_snapshots_restore=function(){var s=null,t=!1;function a(){return null!==s&&s.abort(),t=!0,e("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(snapshot_messages.restore_aborted),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden"),!1}e("#wps-show-full-log").on("click",function(s){s.preventDefault(),e("#wps-log").toggle();var t=e(this),a="data-wps-"+(e("#wps-log").is(":visible")?"hide":"show")+"-title";t.text(t.attr(a))}),e("#wps-build-error-again").on("click",function(s){s.preventDefault(),e("#wps-build-error").addClass("hidden"),e("#wps-build-progress").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").addClass("hidden"),e(".wpmud-box-title .wps-title-progress").removeClass("hidden"),e("form#snapshot-edit-restore").submit()}),e("#wps-build-error-back").on("click",function(s){s.preventDefault(),e("#wps-build-error").addClass("hidden"),e("#wps-build-progress").removeClass("hidden"),e("#snapshot-edit-restore").removeClass("hidden"),e("#container.wps-page-builder").addClass("hidden"),e(".wpmud-box-title .wps-title-result").addClass("hidden"),e(".wpmud-box-title .wps-title-progress").removeClass("hidden")}),e("#wps-cancel").off().on("click",function(e){e.preventDefault(),a()}),e("form#snapshot-edit-restore").off().on("submit",function(){var n=e('input[name="item"]').val(),o=e('input[name="snapshot-blog-id-search"]').val(),r=e("input#snapshot-restore-option-plugins",this).attr("checked");r="checked"===r?"yes":"no";var i=e('input[name="restore-option-theme"]:checked',this).val(),p=[],d=e("input.snapshot-files-option:checked").val();"all"==d||"selected"==d&&(e("input.snapshot-backup-sub-options:checked",this).each(function(){var s=e(this).attr("value");p[p.length]=s}),0===p.length&&(d="all"));var l=[],u=e("input.snapshot-tables-option:checked").val(),h=e("input#snapshot-blog-id").val();"selected"===u?(e("input.snapshot-table-item:checked",this).each(function(){l[l.length]=e(this).attr("value")}),0===l.length&&(u="all")):"all"===u&&e("input.snapshot-table-item",this).each(function(){l[l.length]=e(this).attr("value")});var c=l.length+2,w=0;e("#snapshot-edit-restore").addClass("hidden"),e("#snapshot-ajax-warning").html(""),e("#snapshot-ajax-warning").hide(),e("#container.wps-page-builder").removeClass("hidden");var m=[],b=[],g=e('input:radio[name="snapshot-restore-file"]').val();return function f(y,v){var j,_,C;if("init"===y){var Q='<div class="snapshot-item" id="snapshot-item-table-'+(j=y)+'"><div class="progress"><div class="percent">0%</div><div class="bar" style="width: 0px;"></div></div><button style="display: none;" class="snapshot-button-abort">Abort</button><div class="snapshot-text">Snapshot determining tables/files to restore</div></div>';e("#snapshot-progress-bar-container").append(Q),e("#snapshot-progress-bar-container #snapshot-item-table-"+j+" .progress .bar").width("0%"),e("#snapshot-progress-bar-container #snapshot-item-table-"+j+" .progress .percent").html("0%"),e("#snapshot-progress-bar-container #snapshot-item-table-"+j+" .snapshot-button-abort").show(),e("#snapshot-progress-bar-container #snapshot-item-table-"+j+" button.snapshot-button-abort").on("click",function(){a()}),_={action:"snapshot_restore_ajax",snapshot_action:y,item_key:n,item_data:g,"snapshot-blog-id":h,"snapshot-files-option":d,"snapshot-files-sections":p,"snapshot-tables-option":u,"snapshot-tables-array":l,snapshot_blog_search:o},s=e.ajax({type:"POST",url:ajaxurl,data:_,dataType:"json",error:function(s,t,a){!1!==s.responseText&&""!==s.responseText?(e("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(s.responseText),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden")):(e("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e("#wps-build-progress").addClass("hidden"))},success:function(s){var a;if(null!==s)if(void 0!==s.errorStatus)if(!1===s.errorStatus){if(!1===t){var n="init";e("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-bar span").width("100%"),e("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-number").html("100%"),e("#container.wps-page-builder #wps-log-process-init .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),e("#container.wps-page-builder #wps-log-process-init .snapshot-button-abort").addClass("hidden"),w++;var o=Math.min(100,Math.round(100*w/c));if(e("#wps-build-progress .wps-total-status .wps-loading-number").html(o+"%"),e("#wps-build-progress .wps-total-status .wps-loading-bar span").width(o+"%"),void 0!==s.MANIFEST.TABLES&&Object.keys(s.MANIFEST.TABLES).length){for(n in s.MANIFEST.TABLES)if(s.MANIFEST.TABLES.hasOwnProperty(n)){var r=s.MANIFEST.TABLES[n];a=e('<tr id="snapshot-item-table-'+r.table_name+'"></tr>').append(e("#wps-log-process-template").html()).find(".wps-log-process.name").html(r.label).end(),e("tr#wps-log-process-finish").before(a)}m=s.MANIFEST["TABLES-DATA"]}void 0!==s.MANIFEST["FILES-DATA"]&&Object.keys(s.MANIFEST["FILES-DATA"]).length&&(b=s.MANIFEST["FILES-DATA"],a=e('<tr id="snapshot-item-file"></tr>').append(e("#wps-log-process-template").html()).find(".wps-log-process.name").html('Files: <span class="snapshot-filename" style="font-style: italic;"></span>').end(),e("tr#wps-log-process-finish").before(a)),f("table",0)}}else void 0!==s.errorText&&(e("#wps-build-error .wps-auth-message p").html(s.errorText),e("#wps-build-error").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden"));else e("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),e("#wps-build-error").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden");else e("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),e("#wps-build-error").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden")}})}else if("table"===y){var x=parseInt(v),k=x+1;if(k>m.length)return void(b.length>0?f("file",0):f("finish",0));var S=m[x];j=S.table_name,e("#snapshot-progress-bar-container #snapshot-item-table-"+j+" button.snapshot-button-abort").show().on("click",function(){a()}),_={action:"snapshot_restore_ajax",snapshot_action:y,item_key:n,item_data:g,"snapshot-blog-id":h,snapshot_table:j,table_data:S,snapshot_blog_search:o},s=e.ajax({type:"POST",url:ajaxurl,data:_,timeout:6e5,dataType:"json",error:function(s,t,a){!1!==s.responseText&&""!==s.responseText?(e("#wps-build-error .wps-auth-message p").html(s.responseText),e("#wps-build-error").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden")):(e("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),e("#wps-build-error").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden"))},success:function(s){var a;if(e("#snapshot-progress-bar-container").find("#snapshot-item-table-"+j).find(".snapshot-button-abort").hide(),e("#snapshot-progress-bar-container").find("#snapshot-item-table-"+j).find(".wps-spinner").hide(),void 0!==s.errorStatus)if(!1===s.errorStatus){if(!1===t){if(void 0!==s.table_data){S=s.table_data;var n=parseInt(S.rows_start)+parseInt(S.rows_end);if(n>0?(a=Math.ceil(n/S.rows_total*100),e("#container.wps-page-builder #snapshot-item-table-"+S.table_name+" .wps-loading-status .wps-loading-bar span").width(a+"%"),e("#container.wps-page-builder #snapshot-item-table-"+S.table_name+" .wps-loading-status .wps-loading-number").html(a+"%")):(a=100,e("#container.wps-page-builder #snapshot-item-table-"+S.table_name+" .wps-loading-status .wps-loading-bar span").width(a+"%"),e("#container.wps-page-builder #snapshot-item-table-"+S.table_name+" .wps-loading-status .wps-loading-number").html(a+"%")),100==a){e("#container.wps-page-builder #snapshot-item-table-"+S.table_name+" .snapshot-button-abort").hide(),e("#container.wps-page-builder #snapshot-item-table-"+S.table_name+" .wps-spinner").hide(),e("#container.wps-page-builder #snapshot-item-table-"+S.table_name+" .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),w++;var o=Math.min(100,Math.round(100*w/c));e("#wps-build-progress .wps-total-status .wps-loading-number").html(o+"%"),e("#wps-build-progress .wps-total-status .wps-loading-bar span").width(o+"%")}}f("table",k)}}else e("#wps-build-error .wps-auth-message p").html(s.errorText),e("#wps-build-error").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden");else e("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),e("#wps-build-error").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden")}})}else if("file"==y){var M=parseInt(v),T=M+1;if(j=y,T>b.length)return void(b.length>0&&f("finish",0));var E=b[M];E=void 0!==(C=E)&&C.length?C.replace(/\\/g,"/").replace(/.*\//,""):C,e("#snapshot-item-"+j+" .snapshot-filename").html(": "+E),e("#snapshot-progress-bar-container #snapshot-item-file button.snapshot-button-abort").show(),e("#snapshot-progress-bar-container #snapshot-item-file button.snapshot-button-abort").on("click",function(){a()}),_={action:"snapshot_restore_ajax",snapshot_action:y,item_key:n,item_data:g,file_data_idx:M,"snapshot-blog-id":h},s=e.ajax({type:"POST",url:ajaxurl,data:_,timeout:6e5,dataType:"json",error:function(s,t,a){!1!==s.responseText&&""!==s.responseText?(e("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(s.responseText),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden")):(e("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),e("#wps-build-error").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden"))},success:function(s){var a;if(e("#snapshot-progress-bar-container #snapshot-item-table-"+j+" .snapshot-button-abort").hide(),e("#snapshot-progress-bar-container #snapshot-item-table-"+j+" .wps-spinner").hide(),void 0!==s.errorStatus)if(!1===s.errorStatus){if(!1===t){if(void 0!==s.file_data){if(T<b.length)a=Math.ceil(T/b.length*100),e("#container.wps-page-builder #snapshot-item-"+j+" .wps-loading-status .wps-loading-bar span").width(a+"%"),e("#container.wps-page-builder #snapshot-item-"+j+" .wps-loading-status .wps-loading-number").html(a+"%");else{w++;var n=Math.min(100,Math.round(100*w/c));e("#wps-build-progress .wps-total-status .wps-loading-number").html(n+"%"),e("#wps-build-progress .wps-total-status .wps-loading-bar span").width(n+"%"),a=100,e("#container.wps-page-builder #snapshot-item-"+j+" .wps-loading-status .wps-loading-bar span").width(a+"%"),e("#container.wps-page-builder #snapshot-item-"+j+" .wps-loading-status .wps-loading-number").html(a+"%"),e("#container.wps-page-builder #snapshot-item-"+j+" .wps-loading-status .wps-loading-bar .wps-loader").addClass("done")}100===a&&(e("#snapshot-progress-bar-container #snapshot-item-"+j+" .snapshot-button-abort").hide(),e("#snapshot-progress-bar-container #snapshot-item-"+j+" .wps-spinner").hide(),e("#snapshot-item-"+j+" .snapshot-filename").html(""))}f("file",T)}}else e("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html(s.errorText),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden");else e("#wps-build-error").removeClass("hidden").find(".wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden")}})}else"finish"==y&&(e("#container.wps-page-builder #snapshot-item-table-"+(j=y)+" .wps-loading-status .wps-loading-bar span").width("0%"),e("#container.wps-page-builder #snapshot-item-table-"+j+" .wps-loading-status").addClass("wps-spinner"),e("#container.wps-page-builder #snapshot-item-table-"+j+" .wps-loading-status .wps-loading-number").html("0%"),_={action:"snapshot_restore_ajax",snapshot_action:y,item_key:n,item_data:g,"snapshot-blog-id":h,snapshot_restore_plugin:r,snapshot_restore_theme:i},s=e.ajax({type:"POST",url:ajaxurl,data:_,dataType:"json",error:function(s,t,a){!1!==s.responseText&&""!==s.responseText?(e("#wps-build-error .wps-auth-message p").html(s.responseText),e("#wps-build-error").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden")):(e("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),e("#wps-build-error").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden"))},success:function(s){if(void 0!==s.errorStatus)if(!1===s.errorStatus){if(!1===t){w++;var a=Math.min(100,Math.round(100*w/c));e("#wps-build-progress .wps-total-status .wps-loading-number").html(a+"%"),e("#wps-build-progress .wps-total-status .wps-loading-bar span").width(a+"%");e("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-bar span").width("100%"),e("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-number").html("100%"),e("#container.wps-page-builder #wps-log-process-finish .wps-loading-status .wps-loading-bar .wps-loader").addClass("done"),e("#container.wps-page-builder #wps-log-process-finish .wps-loading-status").removeClass("wps-spinner"),e("#wps-build-success-view").attr("href",e("#wps-build-success .wps-auth-message.success").find("a").attr("href")),e("#wps-build-error").addClass("hidden"),e("#wps-build-progress").addClass("hidden"),void 0!==s.restore_admin_url&&e("a.restored-admin-url").attr("href",s.restore_admin_url),void 0!==s.restore_site_url&&e("a.restored-site-url").attr("href",s.restore_site_url),e("#wps-build-success").removeClass("hidden")}}else e("#wps-build-error .wps-auth-message p").html(s.errorText),e("#wps-build-error").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden");else e("#wps-build-error .wps-auth-message p").html("<p>"+snapshot_messages.snapshot_failed+"</p>"),e("#wps-build-error").removeClass("hidden"),e(".wpmud-box-title .wps-title-result").removeClass("hidden"),e(".wpmud-box-title .wps-title-progress").addClass("hidden"),e("#wps-build-progress").addClass("hidden")}}))}("init",0),!1})}}(jQuery),function(e){window.SS_PAGES.snapshot_page_snapshot_snapshots=function(){e(".wps-menu-dots").each(function(){var s=e(this),t=s.parent(".wps-menu"),a=e(".wps-menu").not(t);s.on("click",function(){a.removeClass("open"),t[t.hasClass("open")?"removeClass":"addClass"]("open")})}),e("#my-snapshot-all").on("change",function(){e('input[id^="my-snapshot"]').attr("checked",e(this).is(":checked"))}),e("#wps-snapshot-log").find(".wps-popup-close").on("click",function(s){s.preventDefault(),e("#wps-snapshot-log").removeClass("show")}),e("#wps-snapshot-log-view").on("click",function(s){s.preventDefault(),e("#wps-snapshot-log .wps-log-box").html(snapshot_messages.loading+"<br />"),e("#wps-snapshot-log").addClass("show");var t=tb_parseQuery(e("#wps-snapshot-log").attr("data-ajax-src")),a=0,n=setInterval(function(){if(e("#wps-snapshot-log").length&&e("#wps-snapshot-log").is(".show")){var s={action:"snapshot_view_log_ajax","snapshot-item":t["snapshot-item"],"snapshot-data-item":t["snapshot-data-item"],"snapshot-log-position":a};snapshot_ajax_hdl_xhr=jQuery.ajax({type:"POST",url:ajaxurl,cache:!1,data:s,dataType:"json",error:function(e,s,t){clearInterval(n)},success:function(s){void 0!==s&&void 0!==s.payload&&(0===a?e("#wps-snapshot-log .wps-log-box").html(s.payload):e("#wps-snapshot-log .wps-log-box").append(s.payload),"1"==t.live&&e("#wps-snapshot-log").length&&e("#wps-snapshot-log .wps-log-box").scrollTop(e("#wps-snapshot-log .wps-log-box")[0].scrollHeight)),void 0!==s&&void 0!==s.position&&a!=s.position&&(a=s.position),0===s.payload.length&&clearInterval(n)}})}else clearInterval(n)},1e3)}),e("body").is(".snapshot_page_snapshot_snapshot_create")||window.SS_PAGES.snapshot_page_snapshot_snapshot_create()}}(jQuery),function(e){SS_UTILS.openModal=function(s,t,a,n){var o=e(e("#ss-modal-template").html());o.find(".wpmud-box-title > h3").html(s),o.find(".wpmud-box-content").html(t),e("#wpbody-content").append(o),"function"==typeof a&&a(),o.fadeIn(),o.on("click",".wpmud-box-title > .close",function(){o.fadeOut(),setTimeout(function(){o.remove(),"function"==typeof n&&n()},400)})}}(jQuery);